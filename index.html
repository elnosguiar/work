<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Task Time Tracker & Analysis</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<style>
/* --- ê¸°ë³¸ ìŠ¤íƒ€ì¼ --- */
body {
    font-family: 'Roboto', sans-serif;
    background-color: #f4f7f6;
    color: #333;
    line-height: 1.6;
    margin: 0;
    padding: 0;
}

/* --- ì»¨í…Œì´ë„ˆ ë° ë ˆì´ì•„ì›ƒ --- */
.time-tracker-container {
    max-width: 900px;
    margin: 40px auto;
    padding: 30px;
    background: #ffffff;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
}

h1 {
    color: #007bff;
    text-align: center;
    margin-bottom: 30px;
    border-bottom: 2px solid #007bff;
    padding-bottom: 10px;
}

h2 {
    color: #555;
    margin-top: 30px;
    margin-bottom: 15px;
}

/* --- ì…ë ¥ ë° ë²„íŠ¼ ê·¸ë£¹ --- */
.input-group {
    display: flex;
    gap: 15px;
    margin-bottom: 25px;
    align-items: center;
}
.input-group input {
    padding: 12px;
    border-radius: 8px;
    border: 1px solid #ddd;
    font-size: 1rem;
    box-sizing: border-box;
}
#task-name { flex: 3; }
#time-spent { flex: 1; text-align: center;}

.btn {
    padding: 12px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 700;
    transition: background-color 0.3s;
}

.btn-primary {
    background: #007bff;
    color: white;
}
.btn-primary:hover {
    background: #0056b3;
}

.btn-danger {
    background: #dc3545;
    color: white;
    margin-top: 20px;
    width: 100%;
}
.btn-danger:hover {
    background: #c82333;
}

/* --- ì°¨íŠ¸ ì˜ì—­ --- */
#chart-area {
    background: #f9f9f9;
    padding: 15px;
    border-radius: 8px;
    border: 1px solid #eee;
}

/* --- ê¸°ë¡ ëª©ë¡ --- */
#log-list {
    list-style: none;
    padding: 0;
}
#log-list li {
    background: #eee;
    padding: 10px;
    margin-bottom: 8px;
    border-radius: 5px;
    display: flex;
    justify-content: space-between;
}
</style>
</head>
<body>

<div class="time-tracker-container">
    <h1>â° Task Time Tracker & Analysis</h1>

    <h2>ê¸°ë¡ ì¶”ê°€</h2>
    <div class="input-group">
        <input type="text" id="task-name" placeholder="ì‘ì—… ì´ë¦„ (ì˜ˆ: ì½”ë”©, ë¯¸íŒ… ì¤€ë¹„)">
        <input type="number" id="time-spent" placeholder="ì†Œìš” ì‹œê°„ (ë¶„)" min="1">
        <button class="btn btn-primary" onclick="logTime()">ê¸°ë¡í•˜ê¸°</button>
    </div>
    
    <hr>
    
    <h2>ğŸ“Š ì£¼ê°„ ì‹œê°„ ì‚¬ìš© ë¶„ì„ (ë¶„ ë‹¨ìœ„)</h2>
    <div id="chart-area">
        <canvas id="timeChart"></canvas>
    </div>

    <hr>

    <h2>ğŸ“ ì „ì²´ ê¸°ë¡ ëª©ë¡</h2>
    <ul id="log-list">
        </ul>
    
    <button class="btn btn-danger" onclick="clearAllData()">ëª¨ë“  ê¸°ë¡ ì§€ìš°ê¸° (ì´ˆê¸°í™”)</button>
</div>

<script>
const DATA_KEY = 'weeklyTimeTrackerData';
let timeChart;

// --- ë°ì´í„° ì²˜ë¦¬ í•¨ìˆ˜ ---

/**
 * ë¡œì»¬ ì €ì¥ì†Œì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.
 * @returns {Object} {ë‚ ì§œ: {ì‘ì—…ì´ë¦„: ì‹œê°„}} í˜•íƒœì˜ ë°ì´í„°
 */
function loadData() {
    const data = localStorage.getItem(DATA_KEY);
    return data ? JSON.parse(data) : {};
}

/**
 * ë°ì´í„°ë¥¼ ë¡œì»¬ ì €ì¥ì†Œì— ì €ì¥í•©ë‹ˆë‹¤.
 * @param {Object} data ì €ì¥í•  ë°ì´í„° ê°ì²´
 */
function saveData(data) {
    localStorage.setItem(DATA_KEY, JSON.stringify(data));
}

/**
 * ë‚ ì§œë¥¼ YYYY-MM-DD í˜•ì‹ì˜ ë¬¸ìì—´ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤.
 * @returns {string} ì˜¤ëŠ˜ ë‚ ì§œ (YYYY-MM-DD)
 */
function getTodayKey() {
    return new Date().toISOString().slice(0, 10);
}

/**
 * ì…ë ¥ëœ ì‹œê°„ì„ ê¸°ë¡í•˜ê³  ì €ì¥í•©ë‹ˆë‹¤.
 */
function logTime() {
    const taskNameEl = document.getElementById('task-name');
    const timeSpentEl = document.getElementById('time-spent');
    
    const taskName = taskNameEl.value.trim();
    const timeSpent = parseInt(timeSpentEl.value);

    if (taskName === "" || isNaN(timeSpent) || timeSpent <= 0) {
        alert("ì‘ì—… ì´ë¦„ê³¼ ìœ íš¨í•œ ì†Œìš” ì‹œê°„(ë¶„)ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
    }

    const allData = loadData();
    const todayKey = getTodayKey();

    // ì˜¤ëŠ˜ ë‚ ì§œ ë°ì´í„° ì´ˆê¸°í™”
    if (!allData[todayKey]) allData[todayKey] = {};
    
    // ì‘ì—… ì‹œê°„ì— ëˆ„ì 
    if (!allData[todayKey][taskName]) allData[todayKey][taskName] = 0;
    allData[todayKey][taskName] += timeSpent;

    saveData(allData);
    
    // ì…ë ¥ì°½ ì´ˆê¸°í™”
    taskNameEl.value = '';
    timeSpentEl.value = '';
    
    // UI ì—…ë°ì´íŠ¸
    renderChart(allData);
    renderLogList(allData);
}

/**
 * ëª¨ë“  ë°ì´í„°ë¥¼ ì§€ì›ë‹ˆë‹¤.
 */
function clearAllData() {
    if (confirm("ê²½ê³ : ëª¨ë“  ê¸°ë¡ì„ ì •ë§ë¡œ ì§€ìš°ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")) {
        localStorage.removeItem(DATA_KEY);
        
        // ì°¨íŠ¸ ì´ˆê¸°í™”
        if (timeChart) timeChart.destroy();
        document.getElementById('timeChart').getContext('2d').clearRect(0, 0, 800, 400);
        
        // ëª©ë¡ ì´ˆê¸°í™”
        document.getElementById('log-list').innerHTML = '';
        
        alert("ëª¨ë“  ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
        
        // ë¹ˆ ë°ì´í„°ë¡œ ì°¨íŠ¸ ì¬ìƒì„±
        renderChart({}); 
    }
}

// --- UI ë Œë”ë§ í•¨ìˆ˜ ---

/**
 * Chart.jsë¥¼ ì‚¬ìš©í•˜ì—¬ ì£¼ê°„ ë°ì´í„° ì‹œê°í™”
 * @param {Object} allData ì „ì²´ ë°ì´í„°
 */
function renderChart(allData) {
    // ì§€ë‚œ 7ì¼ì˜ ë‚ ì§œë¥¼ ê³„ì‚°í•˜ì—¬ ë ˆì´ë¸”ë¡œ ì‚¬ìš©
    const dateKeys = Object.keys(allData).sort().slice(-7);
    const allTasks = new Set();
    
    // ì§€ë‚œ 7ì¼ê°„ì˜ ëª¨ë“  ì‘ì—… ì´ë¦„ ì¶”ì¶œ
    dateKeys.forEach(date => {
        Object.keys(allData[date]).forEach(task => allTasks.add(task));
    });
    const taskLabels = Array.from(allTasks);

    // Chart.js ë°ì´í„°ì…‹ ìƒì„±
    const datasets = taskLabels.map((task, index) => {
        const timeData = dateKeys.map(date => allData[date][task] || 0);
        
        // ìƒ‰ìƒ ë™ì  ìƒì„± (ë‹¨ìˆœí™”ë¥¼ ìœ„í•´ HSL ì‚¬ìš©)
        const hue = (index * 137) % 360; // 137ì€ í™©ê¸ˆë¹„ë¥¼ ì´ìš©í•œ ê°„ê²©
        const color = `hsl(${hue}, 70%, 50%)`;
        
        return {
            label: task,
            data: timeData,
            backgroundColor: color,
            borderColor: color,
            borderWidth: 1,
            fill: false,
            type: 'bar', // ëª¨ë“  ì‘ì—…ì€ ë§‰ëŒ€ ê·¸ë˜í”„
            stack: 'stack1' // ìŠ¤íƒí˜• ë§‰ëŒ€ ê·¸ë˜í”„ë¡œ êµ¬ì„±
        };
    });

    // ê¸°ì¡´ ì°¨íŠ¸ íŒŒê´´ í›„ ì¬ìƒì„± (ì—…ë°ì´íŠ¸)
    if (timeChart) {
        timeChart.destroy();
    }

    const ctx = document.getElementById('timeChart').getContext('2d');
    timeChart = new Chart(ctx, {
        type: 'bar', // ê¸°ë³¸ íƒ€ì…
        data: {
            labels: dateKeys, // ë‚ ì§œ ë ˆì´ë¸”
            datasets: datasets
        },
        options: {
            responsive: true,
            scales: {
                x: {
                    stacked: true,
                    title: { display: true, text: 'ë‚ ì§œ' }
                },
                y: {
                    stacked: true,
                    beginAtZero: true,
                    title: { display: true, text: 'ì´ ì†Œìš” ì‹œê°„ (ë¶„)' }
                }
            },
            plugins: {
                title: { display: true, text: 'ìµœê·¼ 7ì¼ê°„ ì—…ë¬´ ì‹œê°„ ë¶„ì„' },
                tooltip: { mode: 'index', intersect: false }
            }
        }
    });
}

/**
 * ì „ì²´ ê¸°ë¡ ëª©ë¡ì„ HTML ë¦¬ìŠ¤íŠ¸ë¡œ ì¶œë ¥í•©ë‹ˆë‹¤.
 * @param {Object} allData ì „ì²´ ë°ì´í„°
 */
function renderLogList(allData) {
    const listEl = document.getElementById('log-list');
    listEl.innerHTML = '';
    
    // ë‚ ì§œë³„ë¡œ ì •ë ¬í•˜ì—¬ ìµœì‹  ìˆœìœ¼ë¡œ í‘œì‹œ
    const sortedDates = Object.keys(allData).sort().reverse();

    sortedDates.forEach(date => {
        const tasks = allData[date];
        
        // ë‚ ì§œ í—¤ë” ìƒì„±
        const headerLi = document.createElement('li');
        headerLi.innerHTML = `<strong>ğŸ“… ${date}</strong>`;
        headerLi.style.backgroundColor = '#d1e7ff';
        headerLi.style.fontWeight = 'bold';
        listEl.appendChild(headerLi);

        // ì‘ì—… ëª©ë¡ ìƒì„±
        Object.keys(tasks).forEach(taskName => {
            const li = document.createElement('li');
            li.innerHTML = `
                <span>${taskName}</span>
                <span>${tasks[taskName]}ë¶„</span>
            `;
            listEl.appendChild(li);
        });
    });

    if (sortedDates.length === 0) {
        listEl.innerHTML = '<li>ì•„ì§ ê¸°ë¡ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</li>';
    }
}

// --- ì´ˆê¸° ì‹¤í–‰ ---
document.addEventListener('DOMContentLoaded', () => {
    const initialData = loadData();
    renderChart(initialData);
    renderLogList(initialData);
});
</script>

</body>
</html>
